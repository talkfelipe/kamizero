<!-- NOTE SHOW PAGE -->
<div class="container notice-page notice-show-page">

  <!-- HEADER: back + title + subtitle (matches notices index) -->
  <div class="notice-header">
    <%= link_to notes_path, class: "text-decoration-none text-secondary" do %>
      <i class="fa-solid fa-angles-left"></i> <strong>BACK</strong>
    <% end %>

    <h2 class="mx-3">Message Details</h2>
    <p>View this message and reply<i class="fa-solid fa-angles-down"></i></p>
  </div>

  <!-- MAIN NOTE CARD (details) -->
  <div class="card notice-show-card shadow-sm bg-white"
      data-controller="mark-read"
      data-mark-read-url-value="<%= mark_as_read_note_path(@note, format: :json) %>">
    <div class="card-body position-relative">

      <!-- SECTION: NOTE FROM PARENT -->
      <h3 class="note-section-heading">
        MESSAGE FROM PARENT
      </h3>

      <!-- Meta pills -->
      <div class="mb-3 d-flex flex-wrap gap-2 notice-meta-pills">
        <span class="badge rounded-pill pill-meta">
          Grade: <%= @note.student.classroom.grade %>
        </span>
        <span class="badge rounded-pill pill-meta">
          Class: <%= @note.student.classroom.name %>
        </span>
      </div>

      <!-- NOTE title + content -->
      <h4 class="note-title">
        <%= @note.title %>
        <span style="font-size: 0.85rem; font-weight: normal; mx-3">
        <%= @note.created_at.strftime("%Y/%m/%d")%>
        </span>
      </h4>
      <p class="mb-4"><%= @note.content %></p>

      <!-- SECTION SEPARATOR BEFORE REPLY -->
      <hr class="note-section-separator">

      <!-- SECTION: REPLY FROM TEACHER -->
      <h3 class="note-section-heading">
        REPLY FROM TEACHER
      </h3>

      <% if @note.reply.present? %>
        <!-- Already replied: show reply text only -->

        <h4 class="note-title">
          <%= @note.title %>
          <span style="font-size: 0.85rem; font-weight: normal; mx-3">
          <%= @note.created_at.strftime("%Y/%m/%d")%>
          </span>
        </h4>

        <p class="mb-0"><%= @note.reply %></p>


      <% elsif current_user.role == "teacher" %>
        <!-- Teacher, no reply yet: show form -->
        <%= simple_form_for @note, method: :patch do |f| %>
          <%= f.input :reply,
                      label: false,
                      placeholder: "Enter the reply here...",
                      input_html: { style: "height: 200px;" } %>
          <%= f.button :submit, "REPLY", class: "btn note-reply-button" %>
        <% end %>

      <% else %>
        <!-- Parent view, no reply yet -->
        <p class="text-muted mb-0">No reply from the teacher yet.</p>
      <% end %>

    </div>
  </div>
</div>
