<div class="container notice-page notices-page">

  <!-- BACK + PAGE TITLE + SUBTITLE (same as create header) -->
  <div class="notice-header">
    <%= link_to dashboard_path, class: "text-decoration-none text-secondary" do %>
      <i class="fa-solid fa-angles-left"></i> <strong>BACK</strong>
    <% end %>

    <h2>All Notices</h2>
    <p>View All Notices <i class="fa-solid fa-angles-down"></i></p>
  </div>

  <!-- MAIN WHITE CARD (wraps filters + list) -->
  <div class="notice-index-card">

    <!-- FILTERS -->
    <div class="notices-filters-card">
      <%= simple_form_for :filters, url: notices_path, method: :get,
                          html: { class: "notice-filters" } do |f| %>

        <!-- Search + Submit (PC: 4 col, Mobile: row 1 left) -->
        <div class="filter-item search-box">
          <i class="fa-solid fa-magnifying-glass"></i>
          <%= f.input :q,
            wrapper: false,
            label: false,
            input_html: {
              placeholder: "Search",
              class: "filter-input",
              value: params.dig(:filters, :q)
            } %>
          <button type="submit" class="search-submit-btn">
            <i class="fa-solid fa-arrow-right"></i>
          </button>
        </div>

        <!-- Category Filter (PC: 3 col, Mobile: row 2 left) -->
        <div class="filter-item">
          <%= f.input :category,
            collection: [["All Categories", ""], ["General", "General"], ["Event", "Event"]],
            selected: params.dig(:filters, :category),
            label: false,
            wrapper: false,
            input_html: {
              class: "filter-select",
              onchange: "this.form.submit();"
            } %>
        </div>

        <!-- School Filter (PC: 3 col, Mobile: row 2 right) -->
        <% if current_user.role == "parent" %>
        <div class="filter-item">
          <%= f.input :school_id,
            collection: [["All schools", ""]] +
                        current_user.children
                                    .includes(:school)
                                    .map { |s| [s.school.name, s.school.id]},
            selected: params.dig(:filters, :school_id),
            label: false,
            wrapper: false,
            input_html: {
              class: "filter-select",
              onchange: "this.form.submit();"
            } %>
        </div>
        <% end %>

        <!-- Clear (PC: 2 col, Mobile: row 1 right) -->
        <div class="filter-clear-wrapper">
          <%= link_to "CLEAR", notices_path, class: "filter-clear" %>
        </div>

      <% end %>
    </div>

    <!-- NOTICES LIST (original) -->
    <div class="notices-list">
      <% @notices.each do |notice| %>
        <%= link_to notice_path(notice), class: "notice-card position-relative" do %>

          <div class="notice-card-icon">
            <i class="fa-regular fa-file-lines"></i>

            <!-- Category Badge -->
            <span class="badge rounded-pill position-absolute top-0 end-0 m-3
              <%= notice.category == "Event" ? "bg-warning" : "bg-dark" %>">
              <%= notice.category %>
            </span>
          </div>

          <!-- Main Content -->
          <div class="notice-card-main">
            <div class="notice-card-header">
              <h2 class="notice-card-title"><%= notice.title %></h2>
              <p class="notice-card-date"><%= notice.created_at.strftime("%Y-%m-%d") %></p>
            </div>

            <p class="notice-card-body">
              <%= truncate(strip_tags(notice.content), length: 100) %>
            </p>
          </div>

        <% end %>
      <% end %>
    </div>

  </div>
</div>
